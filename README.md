# Physical Verification Workshop using SKY130 PDK
![Logo](https://user-images.githubusercontent.com/109404741/195650208-c2e6f35d-d10e-4a3f-80da-99fa484b6b7a.PNG)
This is a 5 day workshop conducted by VLSI System Design (VSD) from 10th October 2022 to 14th October 2022. This workshop mainly focuses on
the different steps that are required for a physical design verification which includes steps like DRC and LVS. Below is a brief documentation
of the full workshop.

# Day 1 - Introduction to Skywater Sky130 and Open-source EDA tools
## Skywater PDK
  The SkyWater Open Source PDK is a collaboration between Google and SkyWater Technology Foundry to provide a fully open source Process Design Kit and related resources, which can be used to create manufacturable designs at SkyWaterâ€™s facility.
The skywater PDK documentation can be found at the blink below :
https://skywater-pdk.readthedocs.io/en/main/

## Open-source EDA tools

Tools currently supported by open_pdks:
- Magic
- Klayout
- Openlane
- Xschem
- Netgen
- Ngspice
- IVerilog
- qflow
- IRSIM
- xcircuit

The following steps can be followed to instal SKY130 PDKs :

```
git clone https://github.com/RTimothyEdwards/open_pdks
cd open_pdks
configure --enable-sky130-pdk
make
sudo make install
```

The SkyWater PDKs are placed under the directory /usr/share/pdk/sky130A/. There are 2 subdirectories under this folder.One is the libs.tech, which contains all subdirectories for the open source tool setups like xschem (for schematic), Magic(for layout) and netgen(for LVS). The second one is the libs.ref, which contains the reference libraries in various formats.

# Physical verification and Design flow
In functional verification of a circuit we check wether the circuit is giving desired output or not. 
In case of physical verification we check for valid Layout mask (stencils used by manufacturers) and also to match the layout with the actual circuit that we have initially described.

There are two main things in Physical design verification:
1. Design Rule Check (DRC)
2. Layout Vs. Schematic (LVS)

![DRC and LVS](https://user-images.githubusercontent.com/109404741/195654231-124b2417-49aa-473c-89b5-e69b327bb1c0.PNG)

At first we make the schematic using any schematic tool like xschem, eSim etc and then generate the Netlist of the circuit. Then we create a layout of the circuit
using Layout tools like Magic, Klayout. initially, the layout will have some design errors which are discussed later in the documentation. This is where DRC comes
and it helps us to look for error in the design and correct them to meet foundry standards. Then we do an extraction which converts the layout to a netlist file.
Next we compare the netlist generated by the Layout tool and the Schematic tool to compare and look for any mismatches. If there is no mismatch then the layout
fully conforms to the actual design of the circuit.

# Day 1 - Lab
Day 1 lab is all about checking the open-source tools installed in the system and creating a simple inverter circuit from schematic to LVS.

1. To open Magic Layout tool we run the command ```magic``` in the terminal. This brings up a layout window and a console window that is a stock tcl interpreter used to run commands for layout and actions. There are other ways of running Magic tool which uses hardware acceleration. The following command ```magic -d XR``` will run
Magic layout using hardware acceleration. For running Magic using Open GL we can type ```magic -d OGL```.

2. To open Xschem schematic tool we run the command ```xschem``` in the terminal. This will open the schematic window where we can draw out circuit and also generate
Netlist and simulate our circuit.

3. To run Netgen(for LVS) we run the command ```netgen``` in the terminal. It is completely command driven and has no graphics interface. Its console window is a stock tcl interpreter like magic as well. We can get the tcl interpreter in the terminal itself instead of the seperate console window by using the option ```netgen -noconsole```. To run netgen in batch mode, we use the command ```netgen -batch source filename.tcl```. Netgen also provides a GUI window written in python that can be accessed using ```usr/local/lib/netgen/pyhton/lvs_manager.py```, though this interface hides many useful options that cannot be accessed with just this window itself.

## Starting a new project

1. In order to set a working environment for a project we should make a folder with the name of the project and inside it there should be three folder named:

    -mag  (for magic)
    
    -xschem  (for Xschem tool)
    
    -netgen  (for running LVS)
   
![mag_xschem_netgen_folders](https://user-images.githubusercontent.com/109404741/195658089-defc99c3-6afc-4c6d-8268-8ee3a6c723ff.PNG)

Next, we must set up each directory for its respective tool to run properly with the SkyWater PDKs. This can be done by creating a symbolic link between the just initialised subdirectories and the SKY130 submodules created with the open_pdks installer. This is done using ```ln -s /file_path``` in the desired subdirectory, and is shown below. As we will run ngspice simulations using xschem, so we setup ngspice under the xschem subdirectory itself and similarly netgen in the netgen folder
and magic in the magic folder.
![folder setups](https://user-images.githubusercontent.com/109404741/195659657-23332a62-a2e1-48f1-9b15-7a8993c8657f.PNG)
## Designing an inverter

First we have to make the schematic of the inverter circuit so, we go to the xschem folder using ```cd ../xschem``` and then run ```xschem``` which will open the
Xschem tool window.

![xschem window](https://user-images.githubusercontent.com/109404741/195660402-df0c6d1a-e969-4682-abf2-b95b57cbdf3c.PNG)

For creating a new design we go to file and click on new schematic. A black window will appear where we can build our circuit schematic. To insert devices like
I/O pins, transistors (nfets and pfets) we use the "Insert" key on the keyboard. From the window we can select the device. Below is the schematic of the inverter
drawn in the Xschem tool.
![inverter layout](https://user-images.githubusercontent.com/109404741/195662912-3d0c1a6b-212e-4387-80fa-65abbd0841dd.PNG)

To configure the properties of the devices, we can select them by clicking on them and bringing up the parameter window with the Q key. We change the length in the parameter window to 0.18 as the default value of 0.15 is restricted to sram devices only. We can set the number of fingers to 3, and the width of each finger to 1.5. As we have 3 fingers however, the total width in the parameter window must be set to 3 times of the finger width, which is 4.5.

To functionally validate we have to simulate our circuit so, we have to create a testbench in Xschem which can simulate the circuit. The following image is the testbench setup.

![testbench](https://user-images.githubusercontent.com/109404741/195663512-07c30860-82b6-4a2f-b683-890461956abd.PNG)

We set the supply voltage to 1.8V as vdd and for the vss we use the gnd. For input voltage we use a piece wise linear voltage source. In the parametre box we write
the value of the input voltage source as ```value = PWL(0 0 20n 0 900n 1.8)```. The simulation was of transient type and the simulation duration was set to 1us. The following is the simulation result which shows the input and the output voltage:

![inverter output](https://user-images.githubusercontent.com/109404741/195664859-ee066c9e-f860-470b-8496-f6edbb6d153e.PNG)
After this the next step is to create a layout for this inverter circuit. So, we move to the mag directory ```cd ../mag``` and then run ```magic``` in the terminal. This will open the magic tool window. Now we have to open the spice netlist of the inverter circuit. Initially all the ports and transistors will be in a random manner as shown below:
![layout_random_inv](https://user-images.githubusercontent.com/109404741/195665523-43d5d5df-f358-4d3c-b518-c3612f209d69.PNG)

Next, we must set some parameters that are only adjustable in the layout which will make it more convenient to wire the whole layout up. First, we set the "Top guard ring via coverage" to 100. This will put a local interconnect to metal1 via ta the top of the guard ring. Next, for "Source via coverage" put +40 and for "Drain via coverage" put -40. This will split the source drain contacts, making it easy to connect them with a wire. For the nfet, we set the "Bottom guard ring via coverage" to 100, while the source and drain via coverages are set to +40 and -40, respectively, like the pfet. In the above picture it has the I/O pins and the two fets (nfet and pfet). We have to arrange them to draw the inverter circuit and connect them using the Metal 1 layer as shown below :

![layout inv](https://user-images.githubusercontent.com/109404741/195666266-96f8a80c-c29b-43d8-b03e-ca8b2ed6d612.PNG)

After saving and autowriting the layout we have to do the extration. This will create an intermediate file with .ext extention. Then we will convert this file to a SPICE netlist which will be next used by netgen for running LVS check of the inverter circuit. For this we write the following commands in the command window:

```extract do local```  -> This command ensures that magic writes all results to the local directory

```extract all```       -> This command does the actual extraction.

```ext2spice```         -> This command converts the .ext file to the SPICE netlist

Now we can run LVS by entering the netgen subdirectory and using the command ```netgen -batch lvs "../mag/inverter.spice inverter" "../xschem/inverter.spice inverter"```. We should always write the layout spice netlist file name first and then the schematic spice netlist second. The result after running LVS is as follows:

![lvs result](https://user-images.githubusercontent.com/109404741/195669232-74f4525b-10b3-448a-9fb7-00a0f66fb036.PNG)

From the above picture we can see the result after running LVS. At the end it says the the two netlists match. So, we can confirm that our layout perfectly complies
with the Schematic.












